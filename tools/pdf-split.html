<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Split PDF – DocPDFHub</title>
  <link rel="stylesheet" href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css"/>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="/js/i18n.js" defer></script>
  <style>.gradient{background:linear-gradient(90deg,#d53369 0%,#daae51 100%)}</style>
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- Nav -->
  <nav class="w-full bg-white shadow">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="/" class="font-extrabold text-xl"><span data-i18n="common.brand">DocPDFHub</span></a>
      <div class="hidden md:flex space-x-5 text-sm">
        <a href="/" class="hover:text-pink-600" data-i18n="nav.home">Home</a>
        <a href="/tools/pdf-merge.html" class="hover:text-pink-600" data-i18n="nav.merge">Merge PDF</a>
        <a href="/tools/pdf-split.html" class="text-pink-600 font-semibold" data-i18n="nav.split">Split PDF</a>
        <a href="/tools/pdf-compress.html" class="hover:text-pink-600" data-i18n="nav.compress">Compress PDF</a>
        <a href="/tools/pdf-to-jpg.html" class="hover:text-pink-600" data-i18n="nav.tojpg">PDF to JPG</a>
      </div>
      <div class="flex items-center space-x-2 text-sm">
        <button type="button" data-lang-btn="en" onclick="window.__i18n__?.setLang('en')">EN</button>
        <span class="text-gray-300">|</span>
        <button type="button" data-lang-btn="zh" onclick="window.__i18n__?.setLang('zh')">中文</button>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <header class="gradient text-white">
    <div class="max-w-6xl mx-auto px-4 py-12">
      <p class="uppercase tracking-widest opacity-90" data-i18n="home.hero_kicker"></p>
      <h1 class="text-4xl md:text-5xl font-extrabold mt-2" data-i18n="split.title">Split PDF</h1>
      <p class="mt-3 text-white text-opacity-90" data-i18n="split.subtitle"></p>
      <p class="mt-2 text-sm text-white text-opacity-80" data-i18n="common.100_local"></p>
    </div>
  </header>

  <!-- Tool -->
  <main class="max-w-4xl mx-auto px-4 py-10">
    <section class="bg-white rounded-xl shadow p-6">
      <label class="block font-semibold mb-2" data-i18n="common.choose_file"></label>
      <input id="file" type="file" accept="application/pdf" class="w-full border rounded px-3 py-2"/>

      <label class="block font-semibold mt-6 mb-2" data-i18n="split.ranges_label"></label>
      <input id="ranges" type="text" class="w-full border rounded px-3 py-2" data-i18n-attr="placeholder" data-i18n-key="split.ranges_placeholder" placeholder="e.g. 1-3,5,9-"/>

      <div class="mt-6 flex items-center space-x-3">
        <button id="run" class="px-5 py-2 rounded bg-pink-600 text-white font-semibold hover:bg-pink-700" data-i18n="split.split_btn"></button>
        <span id="status" class="text-gray-500 text-sm"></span>
      </div>
    </section>

    <p class="text-xs text-gray-500 mt-6" data-i18n="common.100_local"></p>
  </main>

  <script>
    const { PDFDocument } = PDFLib;

    function parseRanges(text, totalPages){
      // supports: "1-3,5,9-"  (open-ended)
      const parts = text.split(',').map(s=>s.trim()).filter(Boolean);
      const ranges = [];
      for(const part of parts){
        if(part.includes('-')){
          let [a,b] = part.split('-').map(s=>s.trim());
          let start = a ? parseInt(a,10) : 1;
          let end = b ? parseInt(b,10) : totalPages;
          if(isNaN(start) || start<1) start=1;
          if(isNaN(end) || end>totalPages) end=totalPages;
          if(start<=end) ranges.push([start,end]);
        }else{
          const p = parseInt(part,10);
          if(!isNaN(p) && p>=1 && p<=totalPages) ranges.push([p,p]);
        }
      }
      return ranges;
    }

    document.getElementById('run').onclick = async ()=>{
      const file = document.getElementById('file').files[0];
      const status = document.getElementById('status');
      if(!file){
        alert(document.querySelector('[data-i18n="common.choose_file"]')?.textContent || 'Choose PDF file');
        return;
      }
      status.textContent = (document.querySelector('[data-i18n="common.processing"]')?.textContent) || 'Processing...';
      try{
        const bytes = await file.arrayBuffer();
        const pdf = await PDFDocument.load(bytes);
        const total = pdf.getPageCount();
        const input = document.getElementById('ranges').value || `1-${total}`;
        const ranges = parseRanges(input, total);
        if(ranges.length===0){ throw new Error('Invalid ranges'); }

        const zip = new JSZip();
        let i=1;
        for(const [s,e] of ranges){
          const out = await PDFDocument.create();
          const idx = Array.from({length:e-s+1}, (_,k)=> s-1+k);
          const pages = await out.copyPages(pdf, idx);
          pages.forEach(p=> out.addPage(p));
          const outBytes = await out.save({ useObjectStreams: true });
          zip.file(`part-${i++}.pdf`, outBytes);
        }
        const blob = await zip.generateAsync({type:'blob'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'split-parts.zip';
        a.click();
        status.textContent = (document.querySelector('[data-i18n="common.done"]')?.textContent) || 'Done.';
      }catch(err){
        console.error(err);
        status.textContent = (document.querySelector('[data-i18n="common.error"]')?.textContent || 'Something went wrong: ') + err.message;
      }
    };
  </script>
</body>
</html>
