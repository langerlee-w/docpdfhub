<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge"/>

  <!-- 由 i18n.js 接管写入 -->
  <title data-i18n-doc-title="tool.split.ogTitle">Split PDF — DocPDFHub</title>
  <meta name="description" content="Extract pages or split into multiple PDFs — fully local." data-i18n-meta="tool.split.ogDesc"/>

  <link rel="stylesheet" href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css"/>
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet"/>

  <!-- libs -->
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>

  <!-- i18n -->
  <script src="/js/i18n.js" defer></script>

  <style>
    .gradient{background:linear-gradient(90deg,#d53369 0%,#daae51 100%)}
    .dropzone{border:2px dashed #e5e7eb;}
    .drop-active{outline:2px dashed #ec4899; outline-offset:6px; background:#fff7fb}
  </style>
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#ec4899">
  <link rel="canonical" href="https://yourdomain.com/PAGE_PATH">
  <link rel="alternate" href="https://yourdomain.com/PAGE_PATH" hreflang="x-default">
  <link rel="alternate" href="https://yourdomain.com/PAGE_PATH" hreflang="en">
  <link rel="alternate" href="https://yourdomain.com/zh/PAGE_PATH" hreflang="zh">

</head>
<body class="text-gray-900 bg-gray-50" style="font-family:'Source Sans Pro',sans-serif;">

  <!-- Nav -->
  <nav class="fixed w-full z-30 top-0 bg-white shadow">
    <div class="w-full max-w-6xl mx-auto flex items-center justify-between px-4 py-3">
      <a class="text-pink-600 font-extrabold text-2xl" href="/"><span data-i18n="common.brand">DocPDFHub</span></a>
      <div class="hidden md:flex items-center space-x-6 text-sm">
        <a href="/" class="text-gray-700 hover:text-pink-600" data-i18n="nav.home">Home</a>
        <a href="/tools/pdf-merge.html" class="text-gray-700 hover:text-pink-600" data-i18n="nav.merge">Merge PDF</a>
        <a href="/tools/pdf-split.html" class="text-gray-900 font-semibold" data-i18n="nav.split">Split PDF</a>
        <a href="/tools/pdf-compress.html" class="text-gray-700 hover:text-pink-600" data-i18n="nav.compress">Compress PDF</a>
        <a href="/tools/pdf-to-jpg.html" class="text-gray-700 hover:text-pink-600" data-i18n="nav.tojpg">PDF to JPG</a>
        <div class="flex items-center space-x-2">
          <button data-lang-btn="en" class="px-2 py-1 rounded hover:bg-gray-100">EN</button>
          <span class="text-gray-300">|</span>
          <button data-lang-btn="zh" class="px-2 py-1 rounded hover:bg-gray-100">中文</button>
        </div>
      </div>
      <div class="md:hidden flex items-center space-x-2">
        <button data-lang-btn="en" class="px-2 py-1 rounded hover:bg-gray-100">EN</button>
        <button data-lang-btn="zh" class="px-2 py-1 rounded hover:bg-gray-100">中文</button>
      </div>
    </div>
  </nav>
  <div class="pt-20"></div>

  <!-- Hero -->
  <header class="gradient text-white pt-12 pb-10">
    <div class="max-w-6xl mx-auto px-4">
      <p class="uppercase tracking-widest opacity-90 text-sm" data-i18n="home.hero_kicker">PDF TOOLS</p>
      <h1 class="text-4xl md:text-5xl font-extrabold mt-2" data-i18n="tool.split.title">Split PDF</h1>
      <p class="text-white text-opacity-90 mt-2 md:w-3/4" data-i18n="tool.split.subtitle">
        Extract pages or split into multiple PDFs — fully local.
      </p>
      <p class="mt-3 text-sm text-white text-opacity-80" data-i18n="common.100_local">100% local in your browser • No upload</p>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-6xl mx-auto px-4 py-10">
    <div id="dropZone" class="bg-white border rounded-xl p-6 shadow-sm">
      <div class="text-center">
        <h2 class="text-xl font-bold" data-i18n="tool.split.drop.title">Drop a PDF to split</h2>
        <p class="text-gray-600 mt-1" data-i18n="tool.split.drop.hint">Example ranges: 1-3,5,8-10</p>

        <!-- 拖拽 + 点击上传 -->
        <label for="fileInput" class="block mt-4 p-6 border rounded-xl dropzone cursor-pointer">
          <div class="font-semibold" data-i18n="uploader.title">Drop files here or click to select</div>
          <div class="text-xs text-gray-500 mt-1" data-i18n="uploader.hint">Max 100MB each. Your files never leave your device.</div>
          <input id="fileInput" type="file" accept="application/pdf" class="sr-only"/>
        </label>

        <div class="mt-3">
          <button id="chooseBtn" class="bg-pink-600 text-white font-semibold rounded-full py-2 px-5 hover:bg-pink-700"
            data-i18n="tool.split.drop.button">Select PDF</button>
          <div class="text-xs text-gray-500 mt-2" data-i18n="common.or_drop">or drag & drop</div>
        </div>
      </div>

      <!-- 已选择文件 -->
      <div id="fileInfo" class="mt-6 hidden">
        <div class="flex items-center justify-between">
          <div>
            <div id="fileName" class="font-medium"></div>
            <div id="fileSize" class="text-xs text-gray-500"></div>
          </div>
          <button id="replaceBtn" class="text-sm px-3 py-1 rounded border hover:bg-gray-50" data-i18n="tool.split.options.add_more">Replace file</button>
        </div>

        <!-- 选项 -->
        <div class="grid md:grid-cols-3 gap-4 mt-4">
          <div>
            <label class="block text-sm font-medium mb-1" data-i18n="tool.split.options.mode">Split mode</label>
            <select id="mode" class="w-full border rounded px-3 py-2">
              <option value="ranges" data-i18n="tool.split.options.mode_ranges">By page ranges</option>
              <option value="each" data-i18n="tool.split.options.mode_each">Each page into a file</option>
            </select>
          </div>
          <div id="rangesWrap">
            <label class="block text-sm font-medium mb-1" data-i18n="tool.split.options.ranges_label">Page ranges</label>
            <input id="ranges" class="w-full border rounded px-3 py-2" placeholder="e.g. 1-3,5,8-10" data-i18n-placeholder="tool.split.options.ranges_placeholder"/>
          </div>
          <label class="flex items-center space-x-2 mt-6 md:mt-0">
            <input id="skipEmpty" type="checkbox" class="form-checkbox h-4 w-4"/>
            <span class="text-sm" data-i18n="tool.split.options.include_empty">Skip empty pages</span>
          </label>
        </div>

        <!-- 运行 -->
        <div class="mt-6">
          <button id="runBtn" class="bg-pink-600 text-white font-bold rounded-full py-2.5 px-6" data-i18n="tool.split.actions.split">Split PDF</button>
          <p id="runMsg" class="mt-2 text-sm text-gray-500 hidden">
            <span data-i18n="tool.split.running.status">Splitting…</span>
            <span class="ml-1" data-i18n="tool.split.running.tip">Processing is local and secure.</span>
          </p>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t">
    <div class="max-w-6xl mx-auto px-4">
      <div class="w-full flex flex-col md:flex-row py-8 gap-8 text-sm">
        <div class="flex-1">
          <div class="text-pink-600 font-extrabold text-2xl">DocPDFHub</div>
          <p class="text-gray-500 mt-2" data-i18n="footer.tagline">Free & private PDF tools in your browser.</p>
          <p class="text-gray-400 mt-2" data-i18n="common.100_local">100% local in your browser • No upload</p>
        </div>
        <div class="flex-1">
          <p class="uppercase text-gray-500 mb-3" data-i18n="footer.tools">Tools</p>
          <ul class="space-y-2">
            <li><a class="text-gray-700 hover:text-pink-600" href="/tools/pdf-merge.html" data-i18n="nav.merge">Merge PDF</a></li>
            <li><a class="text-gray-700 hover:text-pink-600" href="/tools/pdf-split.html" data-i18n="nav.split">Split PDF</a></li>
            <li><a class="text-gray-700 hover:text-pink-600" href="/tools/pdf-compress.html" data-i18n="nav.compress">Compress PDF</a></li>
            <li><a class="text-gray-700 hover:text-pink-600" href="/tools/pdf-to-jpg.html" data-i18n="nav.tojpg">PDF to JPG</a></li>
          </ul>
        </div>
        <div class="flex-1">
          <p class="uppercase text-gray-500 mb-3" data-i18n="footer.company">Company</p>
          <ul class="space-y-2">
            <li><a class="text-gray-700 hover:text-pink-600" href="#" data-i18n="footer.about">About Us</a></li>
            <li><a class="text-gray-700 hover:text-pink-600" href="#" data-i18n="footer.blog">Official Blog</a></li>
            <li><a class="text-gray-700 hover:text-pink-600" href="#" data-i18n="footer.contact">Contact</a></li>
          </ul>
        </div>
        <div class="flex-1">
          <p class="uppercase text-gray-500 mb-3" data-i18n="footer.legal">Legal</p>
          <ul class="space-y-2">
            <li><a class="text-gray-700 hover:text-pink-600" href="#" data-i18n="footer.terms">Terms</a></li>
            <li><a class="text-gray-700 hover:text-pink-600" href="/privacy.html">Privacy</a></li>
          </ul>
        </div>
      </div>
      <div class="py-4 border-t text-xs text-gray-400">
        © <span id="y"></span> DocPDFHub
      </div>
    </div>
  </footer>

  <script>
  const $ = s=>document.querySelector(s);
  const fileInput = $('#fileInput');
  const chooseBtn = $('#chooseBtn');
  const replaceBtn = $('#replaceBtn');
  const dropZone = document.getElementById('dropZone');
  const fileInfo = $('#fileInfo'); const fileName=$('#fileName'); const fileSize=$('#fileSize');
  const mode = $('#mode'); const rangesWrap=$('#rangesWrap'); const ranges=$('#ranges'); const skipEmpty=$('#skipEmpty');
  const runBtn = $('#runBtn'); const runMsg = $('#runMsg');

  let file = null;

  document.addEventListener('DOMContentLoaded', ()=>{
    const last = DocPDFHub.Store.get('split_opts', { mode:'ranges', ranges:'', skipEmpty:false });
    mode.value = last.mode; ranges.value = last.ranges || ''; skipEmpty.checked = !!last.skipEmpty;
    rangesWrap.style.display = mode.value==='ranges' ? '' : 'none';
  });

  function persistOptions(){
    DocPDFHub.Store.set('split_opts', { mode: mode.value, ranges: ranges.value || '', skipEmpty: !!skipEmpty.checked });
  }

  function showInfo(){
    fileInfo.classList.toggle('hidden', !file);
    if(file){ fileName.textContent=file.name; fileSize.textContent=DocPDFHub.fmtBytes(file.size); }
  }

  ;['dragenter','dragover'].forEach(evt=>{
    dropZone.addEventListener(evt, e=>{ e.preventDefault(); e.stopPropagation(); dropZone.classList.add('drop-active'); });
  });
  ;['dragleave','drop'].forEach(evt=>{
    dropZone.addEventListener(evt, e=>{ e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('drop-active'); });
  });
  dropZone.addEventListener('drop', (e)=>{
    const fs = Array.from(e.dataTransfer.files||[]).filter(f=>/pdf$/i.test(f.name));
    if(fs[0]){ file = fs[0]; showInfo(); }
  });

  fileInput.addEventListener('change', ()=>{
    const fs = Array.from(fileInput.files||[]).filter(f=>/pdf$/i.test(f.name));
    if(fs[0]){ file = fs[0]; showInfo(); }
    fileInput.value='';
  });

  chooseBtn.addEventListener('click', ()=> fileInput.click());
  replaceBtn.addEventListener('click', ()=> fileInput.click());

  mode.addEventListener('change', ()=>{ rangesWrap.style.display = mode.value==='ranges' ? '' : 'none'; });

  const readAB = (f)=> new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsArrayBuffer(f);});

  function parseRanges(str, max){
    if(!str) return [];
    const out = new Set();
    str.split(',').map(s=>s.trim()).filter(Boolean).forEach(part=>{
      const m = part.match(/^(\d+)-(\d+)$/);
      if(m){
        let a=+m[1], b=+m[2]; if(a>b) [a,b]=[b,a];
        for(let i=a;i<=b;i++) if(i>=1&&i<=max) out.add(i);
      }else{
        const n = +part; if(n>=1&&n<=max) out.add(n);
      }
    });
    return Array.from(out).sort((a,b)=>a-b);
  }

  async function splitPDF(){
    if(!file){ alert(window.__i18n__?.t('tool.split.errors.no_pdf') || 'Please add a PDF to split.'); return; }
    runMsg.classList.remove('hidden'); runBtn.disabled = true;
    DocPDFHub.Progress.show(); DocPDFHub.Progress.set(5);

    try{
      persistOptions();

      const { PDFDocument } = PDFLib;
      const bytes = await readAB(file);
      const src = await PDFDocument.load(bytes);
      const total = src.getPageCount();

      let outputs = []; // {name, blob}
      let stepsDone = 0, stepsTotal = 1;

      if (mode.value === 'each') {
        stepsTotal = total;
        for(let p=0;p<total;p++){
          const out = await PDFDocument.create();
          const [page] = await out.copyPages(src, [p]);
          out.addPage(page);
          const outBytes = await out.save({ useObjectStreams: true });
          outputs.push({ name: `page-${p+1}.pdf`, blob: new Blob([outBytes], {type:'application/pdf'}) });

          stepsDone++; DocPDFHub.Progress.set(5 + (stepsDone/stepsTotal)*90);
        }
      } else {
        const pages = parseRanges(ranges.value, total);
        if (!pages.length) { alert(window.__i18n__?.t('tool.split.errors.bad_ranges') || 'Invalid page ranges.'); return; }
        // 连续段
        let segs = []; let start=null, prev=null;
        for(const n of pages){ if(start===null){ start=prev=n; } else if(n===prev+1){ prev=n; } else { segs.push([start,prev]); start=prev=n; } }
        if(start!==null) segs.push([start,prev]);

        stepsTotal = segs.length;
        for(const [a,b] of segs){
          const out = await PDFDocument.create();
          const idx = Array.from({length:b-a+1}, (_,i)=> (a-1)+i);
          const copied = await out.copyPages(src, idx);
          copied.forEach(p=>out.addPage(p));
          const outBytes = await out.save({ useObjectStreams: true });
          outputs.push({ name: `pages-${a}-${b}.pdf`, blob: new Blob([outBytes], {type:'application/pdf'}) });

          stepsDone++; DocPDFHub.Progress.set(5 + (stepsDone/stepsTotal)*90);
        }
      }

      if(outputs.length===1){
        const a = document.createElement('a');
        a.href = URL.createObjectURL(outputs[0].blob);
        a.download = outputs[0].name;
        a.click();
        URL.revokeObjectURL(a.href);
      } else {
        const zip = new JSZip();
        outputs.forEach(f=> zip.file(f.name, f.blob));
        const zipBlob = await zip.generateAsync({type:'blob'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(zipBlob);
        a.download = 'split-output.zip';
        a.click();
        URL.revokeObjectURL(a.href);
      }

      alert(window.__i18n__?.t('tool.split.result.title') || 'Split complete');
    } catch(err){
      console.error(err);
      alert('Failed to split. Please try again.');
    } finally{
      runMsg.classList.add('hidden'); runBtn.disabled=false;
      DocPDFHub.Progress.set(100); setTimeout(()=>DocPDFHub.Progress.hide(),300);
    }
  }

  runBtn.addEventListener('click', splitPDF);
</script>
  <script src="/js/common.js"></script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js').catch(()=>{});
  }
</script>

</body>
</html>
